[TOC]

## SysY2022 抽象语法树定义

2023-05-15 东北重工业 郭冠男

### 1. 概述

抽象语法树的主要设计理念

- 人类可读，可以加注释
- 使用文本文件（后缀名 `.ast`），程序容易解析
- 前端保证给出的 AST 文本一定符合下述形式，因此 **步骤二** 在进行时可以不考虑输入的出错处理问题

#### 1.1 抽象语法树结点基本形式

```N
NodeId NodeType Info_1 Info_2 ... Info_n : SubNodeId_1 SubNodeId_2 ... SubNodeId_m ;
```

其中：

- NodeId 表示抽象语法树结点的编号，是一个 `int32` 范围内的正整数
- NodeType 表示抽象语法树结点的类型，是一个字符串，不以 `@` 开头且字符串中不含空白字符
- Info_x 表示一个结点相关的辅助信息，是一个字符串，不以 `@` 开头且字符串中不含空白字符
- `:` 冒号前的所有内容均为 Info_x，冒号后的所有内容均为 SubNodeId_x，冒号前后各有一个空白字符
- SubNodeId_x 表示一个抽象语法树结点的子节点的编号，是一个 `int32` 范围内的整数

上述符号之间使用至少一个空白字符隔开，抽象语法树结点一定以一个单独的分号为结尾（分号前有空白字符）。

#### 1.2 AST 中的注释

注释的存在仅仅是为了让抽象语法树更加人类可读，便于错误调试，**步骤二** 在读取抽象语法树时应该忽略这些注释。

```
*** 这是注释内容 ***
```

当某个字符串以三个连续星号组成，那么从这个字符串开始之后的若干个字符为注释，直到三个连续的星号下一次出现，注释结束。**抽象语法树保证连续的三个星号与相邻的有效符号之间至少有一个空白字符隔开。** 

```
@这是注释
```

当某一个字符串以 `@` 符号开头时，其后若干字符将会被视为注释，符号 `@` 的前一个字符一定是空白字符，且注释内部一定不含空白字符。

尽管在有些情况下，注释字符串中确实会包含一些关于语法树的信息，但是 **步骤二** 不得使用这些信息。

#### 1.3 注释删除程序

下面的程序给出了一个能够删除 AST 代码中的注释的程序 `AST_DeleteComment.cpp`：

```c++
#include <iostream>
#include <string>

void readUntilCommentEnd() { // 输入多单词注释
    std::string stmp;
    while(std::cin >> stmp) {
        if(stmp == "***") {
            break;
        }
    }
}

int main() {
    std::string stmp = "";
    while(std::cin >> stmp) {          // 从标准输入流输入 AST 代码
        if(stmp.size() >= 1) {
            if(stmp == "***") {        // 输入多单词注释
                readUntilCommentEnd();
            }else if(stmp[0] == '@') { // 输入单单词注释
                // do nothing
            }else {                    // 输入了一个标识符
                std::cout << " " << stmp << " ";
                if(stmp == ";") {
                    std::cout << "\n";
                }
            }
        }
    }
    std::cout << std::endl;
    return 0;
}
```

